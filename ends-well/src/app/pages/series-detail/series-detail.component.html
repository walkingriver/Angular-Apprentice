<div class="series-detail-container">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading series details...</p>
    </div>
  } @else if (error()) {
    <div class="error-container">
      <mat-icon>error_outline</mat-icon>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="goBack()">
        Go Back
      </button>
    </div>
  } @else if (series()) {
    <!-- Hero Section with Backdrop -->
    <div class="series-backdrop" [style.backgroundImage]="'url(' + series()!.backdropPath + ')'">
      <div class="backdrop-overlay">
        <div class="hero-content">
          <div class="series-poster">
            <img [src]="series()!.posterPath" [alt]="series()!.title" class="poster-image" />
          </div>
          <div class="series-info">
            <h1 class="series-title">{{ series()!.title }}</h1>
            <p class="series-years">{{ releaseYear() }}</p>

            <div class="series-meta">
              <span class="rating">
                <mat-icon>star</mat-icon>
                {{ rating() }}
              </span>
              @if (series()!.seasons) {
                <span class="seasons">{{ series()!.seasons }} Seasons</span>
              }
              @if (series()!.episodes) {
                <span class="episodes">{{ series()!.episodes }} Episodes</span>
              }
              @if (series()!.network) {
                <span class="network">{{ series()!.network }}</span>
              }
            </div>

            @if (series()!.genres?.length) {
              <div class="genres">
                @for (genre of series()!.genres; track genre) {
                  <span class="genre-chip">{{ genre }}</span>
                }
              </div>
            }

            <div class="overview">
              <p>{{ series()!.description }}</p>
            </div>

            @if (series()!.starring?.length) {
              <div class="starring">
                <strong>Starring:</strong> {{ series()!.starring?.join(', ') }}
              </div>
            }

            @if (series()!.createdBy?.length) {
              <div class="created-by">
                <strong>Created by:</strong> {{ series()!.createdBy?.join(', ') }}
              </div>
            }

            <div class="actions">
              <button
                mat-raised-button
                color="primary"
                class="watch-trailer"
                (click)="onWatchTrailer()"
              >
                <mat-icon>play_arrow</mat-icon>
                Watch Trailer
              </button>
              <button mat-icon-button (click)="onAddToFavorites()">
                <mat-icon>favorite_border</mat-icon>
              </button>
              <button mat-icon-button (click)="onAddToWatchlist()">
                <mat-icon>bookmark_border</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Rating Section -->
    <div class="rating-section">
      <h2>Your Rating</h2>

      <div class="rating-controls">
        <!-- Ended Well Toggle -->
        <div class="ended-well-rating">
          <label>Did it end well?</label>
          <div class="toggle-buttons">
            <button
              mat-raised-button
              [color]="userEndedWell() === true ? 'primary' : undefined"
              (click)="onEndedWellChange(userEndedWell() === true ? null : true)"
              matTooltip="This series had a satisfying ending"
            >
              <mat-icon>thumb_up</mat-icon>
              Yes
            </button>
            <button
              mat-raised-button
              [color]="userEndedWell() === false ? 'warn' : undefined"
              (click)="onEndedWellChange(userEndedWell() === false ? null : false)"
              matTooltip="This series had a disappointing ending"
            >
              <mat-icon>thumb_down</mat-icon>
              No
            </button>
          </div>
        </div>

        <!-- Star Rating -->
        <div class="star-rating">
          <label>Overall rating</label>
          <div class="stars">
            @for (star of stars; track star) {
              <button
                mat-icon-button
                (click)="onStarRatingChange(star)"
                [class.filled]="userStarRating() !== null && star <= userStarRating()!"
                [matTooltip]="star + ' star' + (star > 1 ? 's' : '')"
              >
                <mat-icon>{{ userStarRating() !== null && star <= userStarRating()! ? 'star' : 'star_border' }}</mat-icon>
              </button>
            }
            @if (userStarRating()) {
              <span class="rating-text">{{ userStarRating() }}/5</span>
            }
          </div>
        </div>
      </div>

      <!-- Comment Section -->
      <div class="comment-section">
        <mat-form-field appearance="outline" class="comment-field">
          <mat-label>Your thoughts on this series</mat-label>
          <textarea
            matInput
            [value]="userComment()"
            (input)="onCommentChange($any($event.target).value)"
            placeholder="What did you think? How was the ending?"
            rows="3"
          ></textarea>
          <mat-hint>Your notes are saved automatically</mat-hint>
        </mat-form-field>
      </div>
    </div>

  }

  <!-- Sticky Footer - always visible -->
  <footer class="sticky-footer">
    <div class="footer-content">
      <button mat-raised-button color="primary" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Back to Browse
      </button>
    </div>
  </footer>
</div>
